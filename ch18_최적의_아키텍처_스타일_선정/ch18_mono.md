# 18.최적의 아키텍처 스타일 선정

거듭 말씀드리지만 상황에 따라 다릅니다! 우리는 이 모든 선택지 （와 거의 매일 생기는 새로운 선택지） 중에서 어느 것을 사용하라고 여러분께 자신 있게 권하고 싶지만 그것은 불가능합니다.

## **18.1** 아키텍처 ‘유행’은 계속 변한다

사람들이 좋아하는 아키텍처 스타일은 여러 가지 팩터들로 인해 그때그때 계속 변합니다.

### 과거를 돌아보다

새로운 아키텍처 스타일은 과거의 경험과 쓰라린 상처를 되돌아보면서 시작됩니다. 아키텍트는 다들 미래의 시스템을 내다보는 현재의 사고에 영향을 미친 과거의 경험을 갖고 있습니다.

그들은 과거의 경험에 의존할 수밖에 없고 애초에 그런 경험이 지금 자신이 아키텍트가 될 수 있게 한 양분이기도 합니다.

### 생태계의 변화

끊임없는 변화는 소프트웨어 개발 생태계의 바람직한 특성입니다. 시간에 따라 불변인 것은 하나도 없습니다. 생태계의 변화는 매우 무질서해서 어떤 종류의 변화가 닥칠지 예측조차 힘들지요.

### 새로운 기능

새로운 기능이 출현하면 아키텍처는 단순히 어떤 도구를 다른 도구로 대체하는 정도가 아닌, 완전히 새로운 패러다임으로 전환될 수 있습니다.

생태계가 지속적인 변화하면서 새로운 도구와 기능들 역시 수시로 등장합니다. 아키텍트는 새로운 도구는 물론 새로운 패러다임 역시 예의주시해야 합니다.

### 가속

생태계는 끊임없이 변할 뿐만 아니라 그 변화의 속도도 계속 빨라지고 있습니다. 새로운 도구는 새로운 엔지니어링 프랙티스를 창출하고 이는 다시 새로운 설계와 기능으로 이어집니다.

### 도메인 변경

비즈니스가 계속 진화하고 타 회사와 합병되면서 개발자가 소프트웨어를 개발하는 도메인 역시 도통 가만히 있는 법이 없습니다. 

### 기술 변화

기술이 진화할수록 조직은 최소한 그 변화의 흐름의 일부라도 （특히 그것이 분명하고 중요한 이익을 가져올 때） 따라잡으려고 합니다.

### 외부 팩터

소프트웨어 개발과 연관된 많은 주변 요인들이 조직의 변화를 가져오는 경우도 있습니다. 아키텍트와 개발자 모두 완벽하게 만족하는 도구가 있는데 라이선스 비용이 너무 비싼 까닭에 어쩔 수 없이 다른 도구를 알아봐야 하는 경우가 그렇습니다.

## **18.2** 결정 기준

아키텍트는 아키텍처 스타일을 선택할 때 도메인 설계 구조의 원인이 될 만한 모든 요소를 종합적으로 고려해야 합니다. 

### 도메인

아키텍트는 도메인에서 중요한 여러 가지 양상, 특히 어느 부분이 운영 아키텍처 특성에 영향을 미치는지 파악해야 합니다. 아키텍트가 *꼭* 해당 분야의 전문가일 필요는 없지만, 자신이 설계하는 도메인에서 중요한 파트에 대해서 최소한의 지식은 갖고 있어야 합니다.

### 구조에 영향을 미치는 아키텍처 특성

아키텍트는 도메인과 다른 외부 요소를 지원하는 데 필요한 아키텍처 특성을 정확하게 밝혀내야합니다.

### 데이터 아키텍처

아키텍트와 DBA는 서로 머리를 맞대고 데이터베이스, 스키마 *등* 데이터에 관한 문제를 의논해야 합니다. 데이터 아키텍처는 그 자체로 전문 분야라서 이 책에서 많은 지면을 할애하지 않지만, 신규 시스템이 이전에 그리고（또는） 현재 사용 중인 데이터 아키텍처와 상호작용할 경우, 아키텍트는 반드시 데이터 설계가 아키텍처 설계에 미치는 영향도를 미리 파악해야 합니다.

### 조직 문제

갖가지 외부 팩터들도 설계에 영향을 줍니다. 예를 들어 특정 클라우드 벤더사의 이용료가 이상적인 설계를 가로막는 장애물이 되거나, 회사가 인수 합병에 참여할 계획을 수립하여 개방형 솔루션과 통합 아키텍처에 무게를 둘 수밖에 없는 경우 등이 있습니다.

### 프로세스, 팀, 운영 문제에 관한 지식

소프트웨어 개발 프로세스, 운영팀과의 소통（또는 그런 소통의 결핍) , QA 프로세스 등 프로젝트와 관련된 다양한 팩터들도 아키텍처 설계에 영향을 끼칩니다. 

### 도메인/아키텍처 동형성

아키텍처의 토폴로지와 잘 맞는 문제 영역이 있습니다. 마이크로커널 아키텍처 스타일은 아키텍처적으로 플러그인 형태의 커스터마이징이 가능하므로 맞춤성이 필요한 시스템과 완벽하게 잘 어울립니다.

반대로, 문제 영역과 아키텍처 스타일이 불협화음이 나는 경우도 있습니다.

### 모놀리스냐 분산이냐

아키텍트는 3장에서 소개한 아키텍처 퀀텀 개념을 이용하여 단일 아키텍처 특성만으로도 설계에 부족함이 없는지, 아니면 시스템 파트별로 상이한 아키텍처 특성이 필요한지 판단해야 합니다. 전자의 경우 （다른 팩터들 때문에 결국 분산 아키텍처로 굳어질 수 있지만） 모놀리스가 적합하다는 뜻이고, 후자의 경우 분산 아키텍처가 정답에 가깝습니다.

### 데이터를 어디에 둘 것인가?

일반적으로 모놀리식 아키텍처는 하나 또는 소수의 관계형 데이터베이스를 전제로 하지만, 분산 아키텍처에서는 아키텍트가 어느 서비스가 어떤 데이터를 저장할지 결정해야 합니다. 즉, 워크플로를 구축하기 전에 전체 아키텍처의 데이터 흐름에 대해 충분히 숙고해야 합니다.

### 서비스 간 통신은 동기, 비동기 중 어떤 스타일로 할 것인가?

데이터를 어떻게 분할할지 정한 다음에는 서비스 간 통신 방식을 동기로 할지, 비동기로 할지결정해야 합니다. 동기 통신은 대부분 더 간편하긴 하지만 확장성, 안정성, 그 밖의 다른 아키텍처 특성에 부정적인 영향을 미칠 수 있습니다. 비동기 통신은 성능, 확장성 측면에서 우월하나, 데이터 동기화, 데드락（교착상태）, 경합 조건, 디버깅 등 골칫거리가 많습니다.

## **18.3** 모놀리스 사례 연구: 실리콘 샌드위치

우리는 실리콘 샌드위치 카타의 아키텍처 특성을 조사한 후 이 시스템은 단일 퀀텀으로 구현해도 충분하다고 결정했습니다. 게다가 이 시스템은 적은 예산으로도 구축 가능한 단순 애플리케이션이므로 모놀리스의 단순함이 더 어울리는 것 같습니다.

### **18.3.1** 모듈러 모놀리스

모듈러 모놀리스는 단일 퀀텀으로 배포된 단일 데이터베이스 기반의 도메인 중심 시스템입니다.

![image](https://github.com/user-attachments/assets/409e9ce4-51de-4504-9e81-3e68884bfd78)

총 비용을 줄이기 위해 （모바일 기기도 설계에 반영된） 단일 웹 기반 유저 인터페이스로 구현한 단일 관계형 데이터베이스 기반의 모놀리스입니다. 앞서 아키텍트가 식별한각 도메인이 이 그림에서 컴포넌트로 표시되어 있습니다. 

아키텍처 스타일 자체는 원래 커스터마이징을 할 수 없기 때문에 아키텍트는 원하는 기능을 도메인 설계의 일부로 달여 넣어야 합니다. 여기서 아키텍트는 개발자가 개별적으로 커스터마이징한 결과물을 업로드할수 있도록 오버라이드 엔드포인트를 설계합니다.

### **18.3.2** 마이크로커널

실리콘 샌드위치에서 식별된 아키텍처 특성 *중* 하나가 맞춤성이었습니다. 

![image](https://github.com/user-attachments/assets/c3b2d14e-bab8-4725-96ca-34ca4a15d68e)

［그림 18-2］에서 코어 시스템은 도메인 컴포넌트와 단일 관계형 데이터베이스로 구성됩니다. 이전 설계와 마찬가지로, 도메인과 데이터를 신중하게 동기화하면 향후 분산 아키텍처로 코어를 마이그레이션할 수 있습니다. 

프런트엔드를 위한 백엔드패턴을 응용해서 API 레이어를 마이크로커널 어댑터로 사용하는 독특한 설계 방법도 있습니다. 

이런식으로 BFF 어댑터를 만들면 마이크로커널 스타일만의 풍부한 유저 인터페이스가 가능하고 향후 다른 장치들까지 확장 지원이 가능합니다.

모듈러 모놀리스, 마이크로커널, 어느 쪽이든 실리콘 샌드위치 아키텍처는 엄청난 성능이나 탄력성을 요하지 않고 오래 걸릴 작업이 없으므로 통신 방식은 동기식으로도 충분합니다.
