# CHAPTER 7 아키텍처 특성 범위
> 소프트웨어 아키텍처 세계에서는 전통적으로 아키텍처 특성의 범위를 시스템 레벨에 두는 것을 당연시했음
예를 들어, 아키텍트가 확장성을 논할 때에는 일반적으로 전체 시스템의 확장성을 가리키는 것
아키텍트는 운영 아키텍처 특성을 따져보고 아키텍처 특성에 영향을 미치는 코드베이스 외부의 컴포넌트를 잘 살펴봐야 함. 이런 종류의 의존성을 측정하기 위해 아키텍처 퀀텀이라는 용어를 정의함
아키텍처 퀀텀의 의미를 이해하려면 먼저 커네이선스라는 핵심 메트릭을 잘 알아두어야함.

## 7.1 커플링과 커네이선스
구심/원심 커플링 같은 코드 레벨의 커플링 메트릭은 아키텍처 분석용으로는 너무 세분도가 높음. 

### 커네이선스

: 커플링 메트릭

아키텍처 퀀텀을 정의하려면 컴포넌트가 어떻게 서로 ‘연결되어’ 있는지 측정할 방법이 필요한데, 이것이 바로 커네이선스라는 개념임. 
두 컴포넌트 중 한쪽이 변경될 경우 다른 쪽도 변경해야 전체 시스템의 정합성이 맞는다면 이들은 커네이선스를 갖고 있는 것이다. 

- 정적 커네이선스
    - 커네이선스를 정적 코드 분석으로 발견할 수 있음
    - 예) 마이크로서비스 아키텍처의 두 서비스가 address라는 동일한 클래스를 공유한다면 두 서비스는 서로 정적인 커네이선스를 가진다고 볼 수 있음. 다시 말해, address라는 공유 클래스를 변경하면 두 서비스도 모두 변경해야 함
- 동적 커네이선스
    - 동기, 비동기 두 종류가 있음
    - 분산 서비스끼리 동기 호출을 하면 호출부는 피호출부의 응답을 기다려야 하는 반면,
    - 이벤트 기반 아키텍처의 비동기 호출은 파이어 앤드 포겟(fire-and-forget) 방식이므로 운영 아키텍처에서 두 서비스는 개별적으로 작동시킬 수 있음

## 7.2 아키텍처 퀀텀과 세분도
소프트웨어를 서로 엮는 것은 컴포넌트 레벨의 커플링만이 아님. 

많은 비즈니스 개념이 의미상 여러 시스템 파트를 한데 엮어 기능적으로 응집되어 있음

성공적으로 소프트웨어를 설계, 분석, 발전시키기 위해 개발자는 문제가 될 만한 커플링 지점을 모두 살펴봐야함. 

쿼텀(양자): 상호작용을 하는 모든 물리 입자 가운데 가장 작은 양, ‘얼마나 많은’, ‘얼마큼의’라는 뜻을 가진 라틴어 퀀텀에서 유래함. 

### 아키텍처 퀀텀

: 높은 기능 응집도와 동기적 커네이선스를 가진, 독립적으로 배포 가능한 아티팩트

- 독립적으로 배포 가능
    
    : 아키텍처 퀀텀은 아키텍처의 다른 파트와 독립적으로 작동되는 모든 필수 컴포넌트를 포함함
    
    예) 데이터베이스를 사용하는 애플리케이션은 데이터베이스 없이는 작동되지 않으므로 데이터베이스는 퀀텀의 일부임. 
    
    이를테면, 단일 데이터베이스를 사용하여 배포된 거의 모든 레거시 시스템은 아키텍처 퀀텀이 1이지만, 마이크로서비스 아키텍처는 서비스마다 데이터베이스가 따로 있으니 퀀텀이 여러 개임
    
- 높은 기능 응집도
    
    : 응집도는 컴포넌트 설계에 따라 구현된 코드가 얼마나 목적에 맞게 통합되어 있는지를 나타냄. 
    
    예) Customer 컴포넌트는 고객 엔티티와 관련된 모든 프로퍼티와 메서드를 갖고 있으므로 응집도가 높지만, Utility 컴포넌트는 여러 가지 잡다한 메서드를 무작위로 섞어 놓아서 응집도가 낮은 편
    
    기능 응집도가 높다 = 아키텍처 퀀텀이 목적에 맞는 뭔가를 하고 있다는 뜻
    
    단일 데이터베이스를 사용하는 기존 모놀리식 애플리케이션에서는 이런 구분이 별로 의미가 없지만, 마이크로서비스 아키텍처는 보통 개발자가 각 서비스를 하나의 워크플로에 맞게 설계하므로 기능 응집도가 높게 나타남
    
- 동기적 커네이선스
    
    : 아키텍처 퀀텀을 형성하는 애플리케이션 콘테스트 내부 또는 분산 서비스 간의 동기 호출을 의미함. 
    
    예) 마이크로서비스 아키텍처에서 어떤 서비스가 다른 서비스를 동기 호출할 때, 운영 아키텍처 특성 측면에서 두 서비스는 두드러진 차이를 나타낼 수 없음. 
    
    호출부가 피호출부보다 확장성이 훨씬 좋다면 타임아웃과 여타 신뢰성 문제가 일어날 것. 따라서 동기 호출은 호출의 길이에 대해 동적 커네이선스를 만들어냄
    
    즉, 한쪽이 다른 쪽을 기다린다면 호출하는 도중에는 양쪽의 운영 아키텍처 특성이 동일해야 함
    
- 도메인 주도 설계의 경계 콘텍스트
    
    DDD는 복잡한 문제 도메인을 체계적으로 분해하는 모델링 기법
    
    DDD는 경계 콘텍스트라는 개념을 정의하는데, 도메인에 관한 모든 것이 내부에서는 보이지만 외부의 다른 경계 콘텍스트에서는 보이지 않음
    

### 7.2.1 사례 연구: GGG (going, going, gone)

GGG라는 온라인 경매 회사의 아키텍처 카타

> **설명**
> 
> - 이 경매 회사는 온라인 경매 시장을 전국적으로 확장하려고 한다. 고객이 참여할 경매를 선택하고 기다렸다가 경매가 시작되면 마치 처음부터 경매인과 같은 공간에 있었던 것처럼 입찰을 시작한다.
> 
> **유저**
> 
> - 경매 당 참여자는 수백 명, 어쩌면 수천 명까지 늘어날 수 있고 많은 동시 경매가 이루어질 것이다.
> 
> **요구사항**
> 
> - 경매는 가급적 실시간 처리가 가능해야 한다.
> - 입찰자는 낙찰 시 자동 결제할 신용카드를 등록한다.
> - 입찰자는 평판 지수로 추적되어야 한다.
> - 입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 한다.
> - 온라인/라이브 입찰 모두 입찰이 일어난 순서대로 접수되어야 한다.
> 
> **부가 콘텍스트**
> 
> - 이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하여 사세를 키우고 있다.
> - 예산 제한은 따로 없다. 전략적으로 그렇게 결정됐다.
> - 이 회사는 위조 혐의로 고발된 소송에서 이제 막 벗어났다.

→ 아키텍트는 각 요구사항을 꼼꼼히 검토해서 아키텍처 특성을 찾아내야 함

- GGG에서 발견한 퀀텀과 아키텍처 특성
    - 입찰자 피드백: 입찰 스트림과 입찰 동영상 스트림을 포함한다.
        - 가용성
        - 확장성
        - 성능
    - 경매인: 라이브 경매인
        - 가용성
        - 신뢰성
        - 확장성
        - 탄력성
        - 성능
        - 보안
    - 입찰자: 온라인 입찰자와 입찰
        - 신뢰성
        - 가용성
        - 확장성
        - 탄력성