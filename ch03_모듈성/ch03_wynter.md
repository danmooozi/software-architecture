# CHAPTER3 모듈성

## 3.1 정의

사전에서는 *복잡한 구조를 만드는 데 쓰이는 각각의 표준화한 부품이나 독립적인 단위*라고 정의합니다. 우리는 모듈성을 이용해 객체 지향 언어의 클래스나 함수형 언어의 함수가 될 만한 서로 연관된 코드를 논리적으로 묶습니다. 

## 3.2 모듈성 측정

### 3.2.1 응집

응집(cohension)은 한 모듈의 파트(구성 요소)가 동일한 모듈 안에 얼마나 포함되어 있는지를 나타냅니다. 다시 말해, 모듈을 구성하는 파트가 서로 얼마나 연관되어 있는가, 하는 것입니다.

#### 기능적 응집

모듈의 각 파트는 다른 파트와 연관되어 있고 기능상 꼭 필요한 모든 것이 모듈에 들어있습니다.

#### 순차적 응집

두 모듈이, 한쪽이 데이터를 출력하면 다른 한 쪽이 그것을 입력 받는 형태로 상호작용합니다.

#### 소통적 응집

두 모듈이, 각자 정보에 따라 작동하고(거나) 어떤 출력을 내는 형태로 통신 체인을 형성합니다. 예를 들면, 데이터베이스에 레코드를 추가하면 그 정보에 따라 이메일이 만들어지는 식입니다.

#### 절차적 응집

두 모듈은 정해진 순서대로 실행되어야 합니다.

#### 일시적 응집

모듈은 시점(timing) 의존성에 따라 연관됩니다. 예를 들어, 많은 시스템들이 시동할 때 그다지 관련 없어 보이는 것들을 죽 초기화하는 경우가 많은데, 이런 작업들이 일시적으로 응집됐다고 할 수 있습니다.

#### 논리적 응집

모듈의 내부 데이터는 기능적이 아니라, 논리적으로 연관되어 있습니다. 자바의 StringUtils 패키지는 각기 다른 작업을 수행하는 정적 메서드가 많이 있지만 서로 연관성은 없습니다.

#### 동시적 응집

같은 소스 파일에 모듈 구성 요소가 들어 있지만 그 외에는 아무 연관성도 없습니다. 이는 가장 좋지 않은 형태의 응집입니다.

**LCOM**
* 응집결여도를 측정하는 방법.
* 공유 필드를 통해 공유되지 않는 메서드의 총 개수
* '구조적'인 부분은 파악 가능하나, '논리적'인 부분은 파악하기 힘듦

### 3.2.2 커플링

메서드의 호출과 반환은 호출 그래프를 형성하므로 수학적인 분석이 가능합니다. **구심커플링**은 컴포넌트, 클래스, 함수 등의 코드 아티팩트로 유입되는 접속 수를, 원심 커플링은 다른 코드 아티팩트로 유출되는 접속 수를 나타냅니다.

### 3.2.3 추상도, 불안정도, 메인 시퀀스로부터의 거리

추상도는 추상 클래스, 인터페이스 등의 추상 아티팩트와 구상 아티팩트의 비율, 구현 대비 추상화 정도를 나타냅니다. 추상도는 추상체들의 합/ 구현체들의 합으로 구할 수 있습니다.

불안정도는 원심 커플링과 구심 커플링 + 원심 커플링의 비율입니다. 여러 다른 클래스를 호출해서 작업을 위임하는 클래스는 호출되는 메서드 중 하나라도 변경되면 호출하는 이 클래스 역시 잘못될 공산이 매우 큽니다.

### 3.2.4 메인 시퀀스로부터의 거리

메인 시퀀스로부터의 거리는 아키텍처 구조를 평가하는 몇 가지 전체적인 메트릭 중 하나로, 불안정도와 추상도를 이용하여 계산합니다.

D = |A(추상도) + I(불안정도) - 1|

### 3.2.5 커네이선스

커네이선스는 변화 종속성. 어느 한쪽을 바꾸면 다른 쪽도 함께 바꾸어야 전체적으로 정합성이 유지되는 상태.

#### 정적 커네이선스

정적 커네이선스는 (실행 시간 커플링과 정반대인) 소스 코드 레벨의 커플링. 아키텍트는 구심적(incoming)이든, 원심적(outgoing)이든 다음 종류의 정적 커네이선스를 뭔가에 커플링된 정도라고 보는 것입니다.

#### 명칭 커네이선스(CoN)

여러 컴포넌트의 엔티티명이 일치해야 합니다. 메서드명은 코드베이스가 커플링되는 가장 일반적이면서 바람직한 방법입니다.

#### 타입 커네이선스(CoT)

여러 컴포넌트의 엔티티 타입이 일치해야 합니다. 대부분의 적적 타입 언어에서 변수와 매개변수를 특정 타입으로 제한하는 일반적인 기능입니다.

#### 의미 커네이선스(CoM) 또는 관례 커네이선스(CoC)

여러 컴포넌트에 걸쳐 어떤 값의 의미가 일치해야 합니다.

#### 위치 커네이선스(CoP)

여러 컴포넌트는 값의 순서가 일치해야 합니다.

#### 알고리즘 커네이선스(CoA)

여러 컴포넌트는 특정 알고리즘이 일치해야 합니다. 로그인시 서버/클라이언트 모두 알고리즘이 일치해야함.

#### 동적 커네이선스

동적 커네이선스는 런타임 호출을 분석하는 것입니다.

#### 실행 커네이선스(CoE)

여러 컴포넌트의 실행 순서가 중요합니다. (프로퍼티 세팅)

#### 시점 커네이선스(CoT)

여러 컴포넌트의 실행 시점이 중요합니다. 동시에 실행 중인 두 스레드 때문에 경합 조건(race condition)이 발생하여 공동 작업의 결과에 영향을 끼치는 것입니다.

#### 값 커네이선스(CoV)

상호 연관된 다수의 값들을 함께 변경할 때 발생합니다.

#### 식별 커네이선스(CoI)

여러 컴포넌트가 동일한 엔티티를 참조할 때 발생합니다. 가장 대표적인 사례는 독립적인 두 컴포넌트가 분산 큐 같은 자료 구조를 공유해서 업데이트해야하는 경우입니다.

페이지-존스가 제시한, 커네이선스를 이용해 모듈성을 개선하는 세 가지 방법입니다.
1. 시스템을 캡슐화한 요소들로 잘게 나누어 전체 커네이선스를 최소화한다.
2. 캡슐화 경계를 벗어나는 나머지 커네이선스를 모조리 최소화한다.
3. 캡슐화 경계 내부에서 커네이선스를 최대화한다.
